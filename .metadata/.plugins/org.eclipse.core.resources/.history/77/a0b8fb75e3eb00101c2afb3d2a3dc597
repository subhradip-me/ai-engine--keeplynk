package com.keeplynk.ai.skill;

import com.keeplynk.ai.agent.AgentContext;
import com.keeplynk.ai.llm.LlmClient;

import org.springframework.core.annotation.Order;
import org.springframework.stereotype.Component;

@Component
@Order(3)
public class TagSkill implements Skill {

    private final LlmClient llmClient;

    public TagSkill(LlmClient llmClient) {
        this.llmClient = llmClient;
    }

    @Override
    public void apply(AgentContext context) {
        context.addReasoning("TagSkill started");
        
        String prompt = """
        		Generate relevant tags for the following URL.

        		URL: %s
        		Persona: %s

        		Rules:
        		- Generate 3-5 relevant tags
        		- Tags should be single words or short phrases (max 2 words)
        		- Use lowercase
        		- Separate tags with commas
        		- Focus on topics, categories, or keywords that describe the resource
        		- Output tags only in format: tag1, tag2, tag3
        		""".formatted(context.getUrl(), context.getPersona());
        
        String tags = llmClient.generate(prompt);
        
        context.getMemory().put("tags", tags);
        
        context.addReasoning("TagSkill inferred tags");
    }
}
