package com.keeplynk.ai.skill;

import com.keeplynk.ai.agent.AgentContext;
import com.keeplynk.ai.llm.LlmClient;

import org.springframework.core.annotation.Order;
import org.springframework.stereotype.Component;

@Component
@Order(4)
public class CategorySkill implements Skill {

    private final LlmClient llmClient;

    public CategorySkill(LlmClient llmClient) {
        this.llmClient = llmClient;
    }

    @Override
    public void apply(AgentContext context) {
        context.addReasoning("CategorySkill started");
        
        String prompt = """
                Categorize the following URL into ONE category/folder name.

                URL: %s
                Persona: %s

                Rules:
                - Choose ONE category that best describes this resource
                - Use simple, clear category names (e.g., Design, Development, Learning, Research, Reading, Work, Projects)
                - Output category name only, no additional text
                - Use title case (e.g., "Design" not "design")
                """.formatted(context.getUrl(), context.getPersona());
        
        String category = llmClient.generate(prompt);
        
        // Clean up category name
        if (category != null) {
            category = category.trim();
            // Capitalize first letter if not already
            if (!category.isEmpty()) {
                category = category.substring(0, 1).toUpperCase() + category.substring(1);
            }
        }
        
        context.getMemory().put("category", category);
        
        context.addReasoning("CategorySkill determined category: " + category);
    }
}
